#!/usr/bin/env bash
######################################################################
# Applies a play button overlay to JPEG images
######################################################################

set -euo pipefail
shopt -s inherit_errexit

readonly SUCCESS=0

######################################################################
# Display usage information
######################################################################
usage() {
  cat << EOF
Usage: ${0##*/} [OPTIONS] FILE
Options:
  -d, --debug    Enable debug output (set -x)
  
Arguments:
  FILE  Path to JPEG image file to overlay
EOF
  exit "${SUCCESS}"
}

######################################################################
# Main function
######################################################################
main() {
  # Parse options
  local debug_mode=false
  while [[ $# -gt 0 ]]; do
    case "$1" in
      -d | --debug)
        debug_mode=true
        shift
        ;;
      -*)
        usage
        ;;
      *)
        break
        ;;
    esac
  done

  # Enable debug if requested
  if [[ "${debug_mode}" == true ]]; then
    set -x
  fi

  # Resolve script directory
  if command -v realpath > /dev/null 2>&1; then
    SCRIPT_DIR=$(dirname "$(realpath "$0")")
  else
    SCRIPT_DIR=$(cd -- "$(dirname -- "$0")" && pwd -P)
  fi
  source "${SCRIPT_DIR}/vidmd.sh"
  overlayicon "$1"
}

if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
  main "$@"
fi
