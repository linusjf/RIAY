#!/usr/bin/env bash

set -euo pipefail
shopt -s inherit_errexit

# Setup script for creating monthly directories and files
# Creates videos file and monthly folders with header.md files

readonly VERSION="1.0.0"
readonly MONTHS=(January February March April May June July August September October November December)

function version() {
  printf "%s\n" "$VERSION"
}

function setup_directories() {
  local year="$1"
  local dir

  # Create empty videos file
  : > "$VIDEOS_FILE"

  # Create monthly directories and files
  for month in "${MONTHS[@]}"; do
    dir="./$month"
    mkdir -p "$dir"
    create_header_file "$dir" "$month" "$year"
    echo "header.md" > "$dir/${COMPACT_FILE}"
  done
}

function create_header_file() {
  local dir="$1"
  local month="$2"
  local year="$3"

  cat > "$dir/header.md" << EOF
<!-- toc -->
<!-- tocstop -->
$month $year

RIAY $month $year
EOF
}

function main() {
  # Resolve script directory
  if command -v realpath > /dev/null 2>&1; then
    SCRIPT_DIR=$(dirname "$(realpath "$0")")
  else
    SCRIPT_DIR=$(cd -- "$(dirname -- "$0")" && pwd -P)
  fi
  source "${SCRIPT_DIR}/lockconfig.sh"
  lock_config_vars "${SCRIPT_DIR}/config.env"

  : "${YEAR:?Environment variable YEAR must be set}"

  setup_directories "$YEAR"
  printf "Setup complete: ${VIDEOS_FILE} plus folders and headers for each month for year %s.\n" "$YEAR"
}

if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
  main "$@"
fi
