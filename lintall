#!/usr/bin/env bash
set -euo pipefail
shopt -s inherit_errexit

require() {
  for cmd in "$@"; do
    if ! hash "$cmd" 2> /dev/null; then
      echo "Error: Required command '$cmd' is not installed or not in PATH." >&2
      exit 1
    fi
  done
}

require markdownlint mdformat

shopt -s globstar # Enable recursive globbing for better portability

echo "Running markdown formatter..."
if ! mdformat -- **/*.md; then
  echo "Error: mdformat failed." >&2
  exit 1
fi

echo "Running markdown linter..."
if ! markdownlint --fix -- **/*.md; then
  echo "Error: markdownlint failed." >&2
  exit 1
fi

echo "All markdown files linted successfully."
exit 0
