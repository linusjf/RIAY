#!/usr/bin/env bash
# shellcheck disable=SC2030,SC2031
# Valid month directories (January-December)
VALID_MONTHS=("January" "February" "March" "April" "May" "June"
  "July" "August" "September" "October" "November" "December")

# Get absolute path to this script and annotatejpg
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd -P)"
ANNOTATE_JPG="${SCRIPT_DIR}/annotatejpg"

# Initialize counter
updated_files=0

# Process all month/jpgs directories
for month in "${VALID_MONTHS[@]}"; do
  jpgdir="${month}/jpgs"

  # Check if directory exists
  if [ ! -d "$jpgdir" ]; then
    echo "No jpgs directory found for month: $month"
    continue
  fi

  # Process all DayXXX.jpg files
  find "$jpgdir" -type f -name "Day*.jpg" | while read -r imgfile; do
    # Call annotatejpg for each file using absolute path
    if "$ANNOTATE_JPG" --silent "$imgfile" 2>&1; then
      # Count updates from annotatejpg output
      ((updated_files++))
    fi
  done
done

echo "Annotation process completed."
echo "Total files updated: $updated_files"
